const __modules = globalThis.__coffeebreak_modules;
const __require = (id) => { const m = __modules?.[id]; if (!m) throw new Error(`Module "${id}" not found in host.`); return m; };
var m1=Object.create;var q=Object.defineProperty;var H1=Object.getOwnPropertyDescriptor;var B1=Object.getOwnPropertyNames;var V1=Object.getPrototypeOf,f1=Object.prototype.hasOwnProperty;var H=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports);var C1=(t,a,r,h)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of B1(a))!f1.call(t,i)&&i!==r&&q(t,i,{get:()=>a[i],enumerable:!(h=H1(a,i))||h.enumerable});return t};var n=(t,a,r)=>(r=t!=null?m1(V1(t)):{},C1(a||!t||!t.__esModule?q(r,"default",{value:t,enumerable:!0}):r,t));var B=H((E1,E)=>{E.exports=__require("react")});var y=H((I1,I)=>{I.exports=__require("@react-keycloak/web")});var N=H((G1,G)=>{G.exports=__require("axios")});var $=H((c2,X)=>{X.exports=__require("react-i18next")});var D=H((H2,d1)=>{d1.exports=__require("react/jsx-runtime")});var o=n(B());var Q=n(B(),1),K=n(y(),1),J=n(N(),1),_=window.__RUNTIME_CONFIG__,w=_&&_.VITE_API_BASE_URL||import.meta?.env?.VITE_API_BASE_URL;function b(){let{keycloak:t}=(0,K.useKeycloak)();return(0,Q.useMemo)(()=>{let a=J.default.create({baseURL:w});return a.interceptors.request.use(async r=>{if(t?.token)try{await t.updateToken(70),r.headers=r.headers||{},r.headers.Authorization=`Bearer ${t.token}`}catch(h){console.error("CoffeeBreak SDK: token refresh failed:",h)}return r}),a},[t])}function Z(t,a){let r=globalThis.__coffeebreak_modules?.i18next;if(!r){console.warn("[coffeebreak] registerPluginTranslations: i18next not found in __coffeebreak_modules");return}for(let[h,i]of Object.entries(a))r.hasResourceBundle(h,t)||r.addResourceBundle(h,t,i)}var L1=n(y(),1);function V(t){return function(){let a=(globalThis.__coffeebreak_ctx_registry||{})[t];if(!a)throw new Error(`CoffeeBreak SDK: "${t}" was not registered. Call registerContexts({ ${t} }) in the host app before rendering plugins.`);return a()}}var Y1=V("useActivities"),X1=V("useMedia"),$1=V("useUsers"),t2=V("useEvent"),Y=V("useNotification");var W=n($());var m=n(B(),1);var O=n(B(),1),P={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},T=O.default.createContext&&O.default.createContext(P);var w1=["attr","size","title"];function A1(t,a){if(t==null)return{};var r=S1(t,a),h,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(i=0;i<l.length;i++)h=l[i],!(a.indexOf(h)>=0)&&Object.prototype.propertyIsEnumerable.call(t,h)&&(r[h]=t[h])}return r}function S1(t,a){if(t==null)return{};var r={};for(var h in t)if(Object.prototype.hasOwnProperty.call(t,h)){if(a.indexOf(h)>=0)continue;r[h]=t[h]}return r}function A(){return A=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&(t[h]=r[h])}return t},A.apply(this,arguments)}function t1(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(t);a&&(h=h.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,h)}return r}function S(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?t1(Object(r),!0).forEach(function(h){F1(t,h,r[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):t1(Object(r)).forEach(function(h){Object.defineProperty(t,h,Object.getOwnPropertyDescriptor(r,h))})}return t}function F1(t,a,r){return a=k1(a),a in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function k1(t){var a=R1(t,"string");return typeof a=="symbol"?a:a+""}function R1(t,a){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var h=r.call(t,a||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function a1(t){return t&&t.map((a,r)=>m.default.createElement(a.tag,S({key:r},a.attr),a1(a.child)))}function u(t){return a=>m.default.createElement(y1,A({attr:S({},t.attr)},a),a1(t.child))}function y1(t){var a=r=>{var{attr:h,size:i,title:l}=t,d=A1(t,w1),v=i||r.size||"1em",g;return r.className&&(g=r.className),t.className&&(g=(g?g+" ":"")+t.className),m.default.createElement("svg",A({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,h,d,{className:g,style:S(S({color:t.color||r.color},r.style),t.style),height:v,width:v,xmlns:"http://www.w3.org/2000/svg"}),l&&m.default.createElement("title",null,l),t.children)};return T!==void 0?m.default.createElement(T.Consumer,null,r=>a(r)):a(P)}function c1(t){return u({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 22a2.98 2.98 0 0 0 2.818-2H9.182A2.98 2.98 0 0 0 12 22zm8.707-5.707L19 14.586V10c0-3.217-2.185-5.926-5.145-6.743C13.562 2.52 12.846 2 12 2s-1.562.52-1.855 1.258C7.185 4.074 5 6.783 5 10v4.586l-1.707 1.707A.997.997 0 0 0 3 17v1a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-1a.997.997 0 0 0-.293-.707zM16 12h-3v3h-2v-3H8v-2h3V7h2v3h3v2z"},child:[]}]})(t)}function r1(t){return u({tag:"svg",attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"},child:[]}]})(t)}function h1(t){return u({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(t)}function i1(t){return u({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(t)}function l1(t){return u({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(t)}var e1={title:"Send Alerts",templates:{title:"Alert Templates"},createAlert:{title:"Send an alert",description:"Send a new alert to notify users about an upcoming event."},createTemplate:{title:"Create a Template",description:"Create a template to send alerts more efficiently."},success:{templateCreated:"Template created successfully",templateUpdated:"Template updated successfully",alertCreated:"Alert sent successfully"},errors:{loadTemplates:"Failed to load templates",requiredFields:"Required fields are missing",createTemplate:"Failed to create template",updateTemplate:"Failed to update template",createAlert:"Failed to send alert"}};var v1={title:"Enviar Alertas",templates:{title:"Modelos de Alertas"},createAlert:{title:"Enviar um alerta",description:"Envie um novo alerta para notificar os usu\xE1rios sobre um evento futuro."},createTemplate:{title:"Criar um Modelo",description:"Crie um modelo para enviar alertas de forma mais eficiente."},success:{templateCreated:"Modelo criado com sucesso",templateUpdated:"Modelo atualizado com sucesso",alertCreated:"Alerta enviado com sucesso"},errors:{loadTemplates:"Falha ao carregar modelos",requiredFields:"Campos obrigat\xF3rios faltando",createTemplate:"Falha ao criar modelo",updateTemplate:"Falha ao atualizar modelo",createAlert:"Falha ao enviar alerta"}};var o1={title:"Enviar Alertas",templates:{title:"Modelos de Alertas"},createAlert:{title:"Enviar um alerta",description:"Envie um novo alerta para notificar os utilizadores sobre um evento futuro."},createTemplate:{title:"Criar um Modelo",description:"Crie um modelo para enviar alertas de forma mais eficiente."},success:{templateCreated:"Modelo criado com sucesso",templateUpdated:"Modelo atualizado com sucesso",alertCreated:"Alerta enviado com sucesso"},errors:{loadTemplates:"Falha ao carregar modelos",requiredFields:"Campos obrigat\xF3rios faltando",createTemplate:"Falha ao criar modelo",updateTemplate:"Falha ao atualizar modelo",createAlert:"Falha ao enviar alerta"}};var c=n(D()),j="alert-system-plugin";Z(j,{en:e1,"pt-BR":v1,"pt-PT":o1});var f=`${w}/alert-system-plugin`;function n1({isOpen:t,onClose:a,title:r,description:h,children:i}){let l=(0,o.useRef)(null);return(0,o.useEffect)(()=>{t?l.current?.showModal():l.current?.close()},[t]),(0,c.jsxs)("dialog",{ref:l,className:"modal rounded-md",onClose:a,onCancel:d=>d.preventDefault(),children:[(0,c.jsxs)("div",{className:"modal-box max-w-2xl",children:[(0,c.jsxs)("div",{className:"mb-6",children:[(0,c.jsx)("h3",{className:"font-bold text-lg",children:r}),h&&(0,c.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:h})]}),(0,c.jsx)("button",{className:"btn absolute right-2 top-2",onClick:a,"aria-label":"Close",children:"\u2715"}),(0,c.jsx)("div",{className:"mt-4",children:i})]}),(0,c.jsx)("button",{className:"modal-backdrop",onClick:a,"aria-label":"Close modal"})]})}function C({label:t,id:a,required:r,children:h}){return(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{htmlFor:a,className:"block text-sm font-medium mb-1",children:[t," ",r&&(0,c.jsx)("span",{className:"text-error",children:"*"})]}),h]})}function P1({onOpenAlertModal:t,onOpenTemplateModal:a}){let{t:r}=(0,W.useTranslation)(j);return(0,c.jsxs)("div",{className:"w-full grid grid-cols-1 gap-4 mt-6 md:grid-cols-2",children:[(0,c.jsx)("button",{className:"card bg-base-200 border-2 border-secondary hover:border-primary shadow-md hover:shadow-lg transition-all duration-300 text-left cursor-pointer",onClick:t,children:(0,c.jsxs)("div",{className:"card-body flex-row items-center gap-4",children:[(0,c.jsx)(c1,{className:"text-4xl text-primary shrink-0"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"card-title",children:r("createAlert.title")}),(0,c.jsx)("p",{className:"text-sm text-gray-500",children:r("createAlert.description")})]})]})}),(0,c.jsx)("button",{className:"card bg-base-200 border-2 border-secondary hover:border-primary shadow-md hover:shadow-lg transition-all duration-300 text-left cursor-pointer",onClick:a,children:(0,c.jsxs)("div",{className:"card-body flex-row items-center gap-4",children:[(0,c.jsx)(r1,{className:"text-4xl text-primary shrink-0"}),(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"card-title",children:r("createTemplate.title")}),(0,c.jsx)("p",{className:"text-sm text-gray-500",children:r("createTemplate.description")})]})]})})]})}function T1({isOpen:t,onClose:a,onSubmit:r,editingTemplate:h,isLoading:i}){return(0,c.jsx)(n1,{isOpen:t,onClose:a,title:h?"Edit Template":"Create New Template",description:h?"Update the template details below.":"Fill in the details to create a new template.",children:(0,c.jsxs)("form",{onSubmit:r,className:"space-y-4",children:[(0,c.jsx)(C,{label:"Title",id:"templateTitle",required:!0,children:(0,c.jsx)("input",{type:"text",id:"templateTitle",name:"templateTitle",placeholder:"Enter template title",className:"input input-bordered w-full",defaultValue:h?.name||"",required:!0})}),(0,c.jsx)(C,{label:"Template Message",id:"templateMessage",required:!0,children:(0,c.jsx)("textarea",{id:"templateMessage",name:"templateMessage",className:"textarea textarea-bordered w-full h-24",defaultValue:h?.template||"",placeholder:"Enter template message",required:!0})}),(0,c.jsx)("div",{className:"mt-6 flex justify-end",children:(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:i,children:i?(0,c.jsx)("span",{className:"loading loading-spinner loading-sm"}):h?"Update Template":"Create Template"})})]})})}function D1({isOpen:t,onClose:a,onSubmit:r,templates:h,isLoading:i}){let l=(0,o.useRef)(null);return(0,c.jsx)(n1,{isOpen:t,onClose:a,title:"Create New Alert",description:"Fill in the details to create a new alert.",children:(0,c.jsxs)("form",{onSubmit:r,className:"space-y-4",children:[(0,c.jsx)(C,{label:"Choose Template",id:"alertTemplate",children:(0,c.jsxs)("select",{id:"alertTemplate",name:"selectedTemplate",className:"select select-bordered w-full",defaultValue:"",onChange:v=>{let g=h.find(s=>String(s.id)===v.target.value);l.current&&(l.current.value=g?.template||"")},children:[(0,c.jsx)("option",{value:"",children:"Select a template"}),h.map(v=>(0,c.jsx)("option",{value:String(v.id),children:v.name},v.id))]})}),(0,c.jsx)(C,{label:"Message",id:"alertMessage",required:!0,children:(0,c.jsx)("textarea",{id:"alertMessage",ref:l,name:"alertMessage",className:"textarea textarea-bordered w-full h-24",placeholder:"Enter alert message",required:!0})}),(0,c.jsx)(C,{label:"High Priority",id:"highPriority",required:!0,children:(0,c.jsxs)("select",{id:"highPriority",name:"highPriority",className:"select select-bordered w-full",defaultValue:"",required:!0,children:[(0,c.jsx)("option",{value:"",children:"Select"}),(0,c.jsx)("option",{value:"Yes",children:"Yes"}),(0,c.jsx)("option",{value:"No",children:"No"})]})}),(0,c.jsx)("div",{className:"mt-6 flex justify-end",children:(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:i,children:i?(0,c.jsx)("span",{className:"loading loading-spinner loading-sm"}):"Create Alert"})})]})})}function W1({searchQuery:t,onSearchChange:a}){return(0,c.jsx)("div",{className:"my-4 flex items-center gap-2",children:(0,c.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,c.jsx)(i1,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),(0,c.jsx)("input",{type:"text",className:"input input-bordered w-full pl-9",placeholder:"Search templates...",value:t,onChange:r=>a(r.target.value)})]})})}function j1({templates:t,onEditTemplate:a,onDeleteTemplate:r}){return t.length?(0,c.jsx)("div",{className:"overflow-x-auto mt-4",children:(0,c.jsxs)("table",{className:"table w-full",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Name"}),(0,c.jsx)("th",{children:"Message"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:t.map(h=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"font-medium",children:h.name}),(0,c.jsx)("td",{className:"max-w-xs truncate",children:h.template}),(0,c.jsxs)("td",{className:"flex gap-2",children:[(0,c.jsx)("button",{className:"btn btn-sm btn-ghost",onClick:()=>a(h),children:(0,c.jsx)(h1,{})}),(0,c.jsx)("button",{className:"btn btn-sm btn-ghost text-error",onClick:()=>r(h.id),children:(0,c.jsx)(l1,{})})]})]},h.id))})]})}):(0,c.jsx)("p",{className:"text-gray-500 my-4",children:"No templates found."})}function U1(){let t=b(),{t:a}=(0,W.useTranslation)(j),{showNotification:r}=Y(),[h,i]=(0,o.useState)([]),[l,d]=(0,o.useState)(!1),[v,g]=(0,o.useState)(""),[s,F]=(0,o.useState)(null),[g1,k]=(0,o.useState)(!1),[z1,L]=(0,o.useState)(!1);(0,o.useEffect)(()=>{u1()},[]);let u1=async()=>{d(!0);try{let{data:e}=await t.get(`${f}/template/`);i(e)}catch(e){console.error("Failed to load templates:",e),r(a("errors.loadTemplates"),"error")}finally{d(!1)}},s1=async e=>{e.preventDefault();let p=new FormData(e.target),z=p.get("templateTitle"),M=p.get("templateMessage");if(!z||!M){r(a("errors.requiredFields"),"error");return}d(!0);try{if(s){let{data:x}=await t.put(`${f}/template/${s.id}`,{name:z,template:M});i(R=>R.map(U=>U.id===s.id?x:U)),r(a("success.templateUpdated"),"success"),F(null)}else{let{data:x}=await t.post(`${f}/template/`,{name:z,template:M});i(R=>[...R,x]),r(a("success.templateCreated"),"success")}L(!1)}catch(x){console.error("Error with template:",x),r(a(s?"alerts.errors.updateTemplate":"alerts.errors.createTemplate"),"error")}finally{d(!1)}},p1=async e=>{await t.delete(`${f}/template/${e}`),i(p=>p.filter(z=>z.id!==e))},x1=async e=>{e.preventDefault();let p=new FormData(e.target),z=p.get("alertMessage"),M=p.get("highPriority");if(!z||!M){r(a("errors.requiredFields"),"error");return}d(!0);try{await t.post(`${f}/alert/`,{message:z,high_priority:M==="Yes"}),r(a("success.alertCreated"),"success"),k(!1)}catch(x){console.error("Error creating alert:",x),r(a("errors.createAlert"),"error")}finally{d(!1)}},M1=h.filter(e=>!v||e.name.toLowerCase().includes(v.toLowerCase())||e.template.toLowerCase().includes(v.toLowerCase()));return l&&h.length===0?(0,c.jsx)("div",{className:"w-full min-h-svh p-8 flex justify-center items-center",children:(0,c.jsx)("span",{className:"loading loading-spinner loading-lg"})}):(0,c.jsxs)("div",{className:"w-full min-h-screen p-4 sm:p-6 lg:p-8",children:[(0,c.jsx)("h1",{className:"text-3xl font-bold my-8",children:a("title")}),(0,c.jsx)(P1,{onOpenAlertModal:()=>k(!0),onOpenTemplateModal:()=>L(!0)}),(0,c.jsx)("h1",{className:"text-3xl font-bold mt-8",children:a("templates.title")}),(0,c.jsx)(W1,{searchQuery:v,onSearchChange:g}),(0,c.jsx)(j1,{templates:M1,onEditTemplate:e=>{F(e),L(!0)},onDeleteTemplate:p1}),(0,c.jsx)(D1,{isOpen:g1,onClose:()=>k(!1),onSubmit:x1,templates:h,isLoading:l}),(0,c.jsx)(T1,{isOpen:z1,onClose:()=>{L(!1),F(null)},onSubmit:s1,editingTemplate:s,isLoading:l})]})}export{U1 as default};
